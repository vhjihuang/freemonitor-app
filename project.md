🎯 FreeMonitor 开发路线图
目录

阶段一：认证系统完善 [90% 完成]
阶段二：核心监控功能 [70% 完成]
阶段三：数据展示与处理 [30% 完成]
阶段四：用户体验优化 [40% 完成]
阶段五：API 与数据流 [60% 完成]
阶段六：后端服务完善 [50% 完成]
阶段七：安全增强 [70% 完成]
阶段八：测试与质量 [10% 完成]
阶段九：部署与运维 [10% 完成]
数据库模式关系图
推荐开发顺序
优先级标记
变更日志
术语表
任务状态更新指南


任务状态更新指南
任务状态通过 Markdown 标记表示：

[x]：已完成
[ ]：未开始
[~]：进行中

更新方式：

打开 TODO.md 文件。
找到相关任务，编辑状态标记（例如，将 [ ] 改为 [x] 表示完成）。
若任务进行中，添加子任务或备注说明阻碍。
保存文件并提交到版本控制（如 Git）。
可选：将任务链接到 GitHub Issues（如 #Issue123），在 issue 中更新详细状态。

未来扩展：

可将任务导入 Notion、Trello 或自定义 Web 应用以支持交互式勾选。
联系项目负责人以获取工具迁移指导。


阶段一：认证系统完善 [90% 完成]
后端认证 🔴

 修复 dev-auth.guard.ts 配置问题
状态: 已完成
描述: 为开发环境创建专用认证守卫，保持生产环境 JWT 认证不变
实现逻辑: 创建 DevAuthGuard -> 开发环境自动注入测试用户 -> 根据环境变量切换认证方式
相关文件: apps/backend/src/auth/dev-auth.guard.ts, apps/backend/src/auth/auth.module.ts
验收标准:
- 环境区分：开发环境自动绕过JWT认证，生产环境强制JWT验证
- 配置灵活：通过环境变量控制认证开关，支持快速切换
- 安全隔离：绕过模式仅适用于开发环境，生产环境无法启用
- 用户模拟：开发环境支持固定测试用户身份，便于调试
- 文档清晰：README中明确说明开发环境认证绕过机制
- 代码审查：绕过逻辑添加明显注释，防止意外部署到生产
- 测试覆盖：单元测试验证两种环境的认证行为差异
更新方式: 无需进一步更新，已完成


 完善 auth.service.ts 登录逻辑
状态: 已完成
描述: 实现用户凭据验证和双令牌机制
实现逻辑: 接收邮箱和密码 -> 查询数据库 -> 验证密码哈希 -> 生成 JWT 访问和刷新令牌
相关文件: apps/backend/src/auth/auth.service.ts
验收标准:
- 成功响应：登录成功后返回包含access_token和refresh_token的JWT对象，有效期分别为15分钟和7天
    - 错误处理：密码错误返回401状态码，用户不存在返回404状态码，账号锁定返回423状态码
    - 错误信息：错误响应包含user-friendly的message字段和developer-friendly的error_code字段
    - 响应格式：统一JSON格式，包含success、data、message三个标准字段
    - 安全限制：连续5次登录失败后账号锁定15分钟，防止暴力破解
    - 日志记录：所有登录尝试记录用户IP、时间戳、结果状态到安全日志
    - 性能要求：登录接口响应时间 < 500ms，支持100并发用户同时登录
更新方式: 无需进一步更新，已完成


 实现 JWT 策略验证
状态: 已完成
描述: 创建 JwtStrategy 处理 JWT 验证
实现逻辑: 从请求头提取 JWT -> 验证有效性 -> 查询用户信息并附加到请求
相关文件: apps/backend/src/auth/jwt.strategy.ts
验收标准:
- 验证机制：支持Bearer Token格式，自动从Authorization头提取JWT令牌
    - 成功响应：有效JWT返回包含用户ID、邮箱、角色、创建时间的完整用户信息对象
    - 错误处理：无效JWT返回401状态码，过期令牌返回403状态码，格式错误返回400状态码
    - 响应时间：用户信息查询响应时间 < 100ms，使用Redis缓存用户会话
    - 缓存策略：用户信息缓存5分钟，令牌验证结果缓存1分钟，减少数据库查询
    - 安全验证：验证JWT签名算法、过期时间、发行者，防止令牌伪造
    - 日志记录：记录每次验证的用户ID、IP地址、验证结果到访问日志
更新方式: 无需进一步更新，已完成


 添加刷新令牌端点
状态: 已完成
描述: 创建 /auth/refresh 端点延续会话
实现逻辑: 接收刷新令牌 -> 验证有效性 -> 生成新访问令牌
相关文件: apps/backend/src/auth/auth.controller.ts
验收标准:
- 令牌刷新：有效刷新令牌返回新的15分钟有效期的access_token，保持原有refresh_token不变
    - 安全机制：刷新令牌使用后标记为已使用，防止重放攻击，7天未使用自动过期
    - 错误处理：无效刷新令牌返回401状态码，过期令牌返回403状态码，已使用令牌返回410状态码
    - 响应格式：统一JSON格式返回{access_token, token_type, expires_in}三个字段
    - 频率限制：每用户每小时最多刷新10次令牌，防止滥用刷新机制
    - 审计日志：记录每次令牌刷新的用户ID、时间戳、IP地址、刷新结果
    - 性能要求：令牌刷新接口响应时间 < 200ms，支持Redis缓存刷新令牌状态
更新方式: 无需进一步更新，已完成


 创建用户注册服务
状态: 已完成
描述: 实现 /auth/register 端点
实现逻辑: 验证邮箱唯一性 -> 加密密码 -> 创建用户 -> 返回认证信息
相关文件: apps/backend/src/auth/auth.controller.ts, apps/backend/src/auth/auth.service.ts
验收标准:
- 注册成功：新用户创建后返回包含access_token和refresh_token的JWT对象，用户状态设为active
    - 邮箱验证：注册时验证邮箱格式有效性，发送验证邮件，24小时内有效
    - 冲突处理：邮箱已存在返回409状态码，附带详细的错误信息和解决建议
    - 密码要求：最少8位字符，包含大小写字母、数字、特殊字符，实时强度提示
    - 安全限制：同一IP 1小时内最多注册5个账号，防止批量注册攻击
    - 数据验证：用户名3-50字符，仅支持中英文、数字、下划线，自动去除空格
    - 响应格式：统一JSON格式，包含success、data、message字段，注册时间 < 1秒
更新方式: 无需进一步更新，已完成


 添加密码重置功能
状态: 已完成
描述: 实现密码重置流程
实现逻辑: 生成重置令牌 -> 保存到数据库 -> 用户通过令牌重置密码 -> 清除令牌
相关文件: apps/backend/src/auth/auth.controller.ts (L37-L47, L75-L85), apps/backend/src/auth/auth.service.ts (L167-L212)
验收标准:
- 重置流程：有效重置令牌允许用户设置新密码，令牌有效期30分钟，单次使用
    - 令牌验证：验证重置令牌的签名、过期时间、使用状态，防止伪造和重用
    - 密码更新：成功重置后密码立即生效，所有现有令牌失效，强制重新登录
    - 错误处理：过期令牌返回403状态码，无效令牌返回401，已使用令牌返回410
    - 安全检查：新密码不能与最近3次密码相同，重置后发送确认邮件通知
    - 频率限制：每用户每24小时最多申请3次密码重置，防止滥用
    - 审计日志：记录密码重置的用户ID、时间戳、IP地址、重置结果到安全日志
更新方式: 无需进一步更新，已完成


[x] 实现密码重置邮件发送功能
状态: 已完成
描述: 集成邮件服务发送密码重置链接
实现逻辑: 生成重置令牌 -> 构造链接 -> 调用邮件服务 -> 输出到控制台（待集成真实服务）
相关文件: apps/backend/src/auth/auth.service.ts (L199)
子任务:
 创建邮件服务框架 (MailService, MailModule)
 集成真实邮件服务
候选: Nodemailer, SendGrid
决策标准: 成本、送达率、TypeScript 支持
阻碍: 待确认邮件服务提供商


 添加邮件模板系统
 实现错误处理和重试机制


验收标准:
- 发送成功：邮件在5秒内成功投递到用户邮箱，支持HTML和纯文本两种格式
    - 模板系统：邮件模板支持变量替换，包含品牌标识、操作指引、安全提示
    - 错误处理：SMTP连接失败重试3次，邮箱不存在记录到错误日志，发送失败返回明确错误码
    - 日志记录：记录邮件发送的用户ID、目标邮箱、模板类型、发送结果、耗时
    - 异步处理：邮件发送使用消息队列异步处理，避免阻塞主线程，支持失败重试
    - 配置灵活：支持多种邮件服务商(SendGrid、AWS SES、SMTP)，通过环境变量配置
    - 监控告警：邮件发送成功率 < 95%时触发告警，24小时内发送量统计报告
依赖: 创建邮件服务框架（已完成）
更新方式: 完成任务后，编辑 TODO.md 将 [~] 改为 [x]，并在变更日志中记录


 实现权限装饰器 🔴
状态: 未开始
描述: 创建基于角色的权限控制机制
实现逻辑: 定义角色枚举 -> 创建 Roles 装饰器 -> 实现 RolesGuard -> 注册守卫 -> 应用到路由
相关文件: apps/backend/src/auth/decorators, apps/backend/src/auth/guards
子任务:
 定义角色枚举 (packages/types/src/roles.ts)
 创建 Roles 装饰器
 实现 RolesGuard 守卫
 在 AuthModule 注册守卫
 测试受保护路由


验收标准:
- 角色验证：支持admin、user、viewer三种角色，精确匹配路由所需权限
    - 权限粒度：API级别权限控制，支持GET、POST、PUT、DELETE方法分别授权
    - 错误响应：无权限访问返回403状态码，包含当前用户角色和所需角色信息
    - 动态权限：支持运行时权限变更，无需重启服务，变更立即生效
    - 审计追踪：记录每次权限检查的用户ID、访问资源、检查结果、时间戳
    - 缓存策略：用户权限缓存5分钟，权限变更后缓存自动失效
    - 测试覆盖：单元测试覆盖所有角色权限组合，集成测试验证端到端权限控制
负责人: 未分配
更新方式: 完成子任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录



模块关系图:
graph TD
    A[前端登录页面] -->|HTTP请求| B[AuthController]
    B -->|调用| C[AuthService]
    C -->|使用| D[JwtService]
    C -->|查询| E[User表]
    C -->|返回结果| F[AuthContext]
    F -->|全局共享| G[其他页面组件]

前端认证 🔴

 完善登录页面功能
状态: 已完成
描述: 实现登录表单和后端 API 集成
实现逻辑: 用户输入邮箱和密码 -> 前端验证 -> 调用登录接口 -> 存储令牌 -> 跳转仪表板
相关文件: apps/frontend/src/components/auth/LoginForm.tsx (L1-L115)
验收标准:
- 成功流程：登录成功后300ms内跳转到仪表板首页，清除登录表单数据
    - 错误提示：邮箱格式错误实时显示，密码错误显示"邮箱或密码错误"，3秒后自动消失
    - 加载状态：登录按钮点击后显示加载动画，禁用表单输入，防止重复提交
    - 表单验证：前端实时验证邮箱格式、密码长度，提交前阻止无效请求
    - 记住我：支持7天自动登录选项，使用安全cookie存储加密令牌
    - 响应式设计：移动端登录表单自适应，触摸目标最小44×44像素
    - 可访问性：支持键盘导航，表单字段有正确的label和aria属性
更新方式: 无需进一步更新，已完成


 实现注册页面
状态: 已完成
描述: 创建注册表单并集成后端 API
实现逻辑: 用户填写注册信息 -> 前端验证 -> 调用注册接口 -> 存储令牌 -> 跳转仪表板
相关文件: apps/frontend/src/components/auth
验收标准:
- 注册流程：成功后自动登录并跳转到仪表板，整个过程 < 3秒，无需二次确认
    - 实时验证：邮箱实时检查是否已注册，密码强度实时评分，用户名即时可用性检测
    - 错误处理：每项输入独立验证，错误信息具体到字段级别，支持实时修正
    - 用户体验：注册按钮根据表单有效性动态启用，提供清晰的注册进度指示
    - 数据安全：密码前端加密传输，使用HTTPS和CSP策略防止中间人攻击
    - 条款确认：包含服务条款和隐私政策勾选框，未勾选时阻止注册
    - 成功反馈：注册成功后显示欢迎消息，自动完成邮箱验证流程
更新方式: 无需进一步更新，已完成


 添加忘记密码页面
状态: 已完成
描述: 实现密码重置请求页面
实现逻辑: 用户输入邮箱 -> 调用重置接口 -> 显示成功提示
相关文件: apps/frontend/src/app/auth/forgot-password/page.tsx (L1-L120)
验收标准:
- 提交流程：邮箱提交后显示"重置邮件已发送"成功提示，整个过程 < 2秒
    - 邮箱验证：实时验证邮箱格式有效性，检查邮箱是否存在于系统，提供明确错误信息
    - 防滥用机制：同一邮箱1小时内最多申请3次密码重置，超限显示友好提示
    - 用户体验：提交按钮带加载状态，禁用期间防止重复点击，支持回车键提交
    - 安全提示：明确告知用户检查垃圾邮件箱，重置链接30分钟内有效
    - 响应适配：移动端表单宽度100%，触摸目标44px以上，支持iOS/Android键盘类型
    - 可访问性：支持屏幕阅读器，表单有正确的tab键导航顺序和焦点管理
更新方式: 无需进一步更新，已完成


 创建认证上下文提供者
状态: 已完成
描述: 实现全局认证状态管理
实现逻辑: 创建 AuthContext 和 useAuth Hook -> 提供登录、登出、用户信息方法
相关文件: apps/frontend/src/app/auth
验收标准:
- 状态同步：认证状态在浏览器标签页间实时同步，支持localStorage和cookie双重存储
    - 令牌管理：自动处理access_token过期刷新，静默刷新期间用户体验无感知
    - 用户信息：用户资料缓存5分钟，支持手动刷新和自动更新机制
    - 错误恢复：令牌刷新失败自动跳转登录页，清除本地认证信息
    - 开发工具：提供React DevTools插件支持，可查看当前认证状态和令牌信息
    - 类型安全：TypeScript完整类型定义，包含AuthUser、AuthTokens、AuthError等接口
    - 性能优化：状态更新使用浅比较，避免不必要的组件重新渲染，内存使用 < 1MB
更新方式: 无需进一步更新，已完成


 实现路由守卫组件 🔴
状态: 进行中
描述: 保护受限路由，防止未认证访问
实现逻辑: 创建 AuthGuard -> 检查认证状态 -> 未认证重定向登录页
相关文件: apps/frontend/src/components/auth
验收标准:
- 路由保护：未认证用户访问受保护路由自动重定向到登录页，保留原始目标URL
    - 角色验证：基于用户角色动态控制路由访问，支持多级权限继承机制
    - 状态恢复：登录成功后自动跳转回原始目标页面，支持浏览器前进后退
    - 加载优化：路由守卫执行时间 < 100ms，异步验证使用Suspense边界
    - 错误处理：认证检查失败显示友好错误页，提供重新登录选项
    - 开发模式：开发环境提供绕过认证开关，便于调试不同权限场景
    - 测试覆盖：单元测试覆盖所有受保护路由，集成测试验证权限边界
依赖: 创建认证上下文提供者（已完成）
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 添加加载状态处理
状态: 已完成
描述: 显示表单提交加载状态
实现逻辑: 表单提交时显示加载指示器 -> 请求完成隐藏
相关文件: apps/frontend/src/components/auth/LoginForm.tsx (L27, L64)
验收标准:
- 视觉反馈：提交按钮显示旋转加载图标，文字变为"处理中..."，禁用状态防止重复提交
    - 覆盖层：全局半透明遮罩防止用户交互，透明度0.5，包含取消操作选项
    - 超时处理：加载超过10秒显示超时提示，提供重试和取消按钮
    - 进度显示：长操作显示真实进度条(0-100%)，短操作使用无限循环动画
    - 错误恢复：加载失败后恢复按钮原始状态，错误信息3秒后自动消失
    - 性能优化：加载动画使用CSS3硬件加速，避免页面卡顿，内存占用 < 1MB
    - 可访问性：加载状态支持屏幕阅读器，提供aria-busy和aria-live属性
更新方式: 无需进一步更新，已完成


 完善错误处理显示
状态: 已完成
描述: 统一错误信息显示和自动清除
实现逻辑: 捕获 API 错误 -> 格式化显示 -> 自动清除
相关文件: apps/frontend/src/components/auth/LoginForm.tsx (L85-L100)
验收标准:
- 显示策略：错误信息在表单字段下方或页面顶部显示，使用红色警告样式和图标
    - 清除机制：3秒后自动消失，用户点击关闭按钮立即清除，表单重新输入时实时清除
    - 信息层次：区分用户友好信息(如"登录失败")和技术详情(仅开发模式显示)
    - 动画效果：错误出现使用淡入动画，消失使用淡出动画，持续时间300ms
    - 位置管理：多字段错误按字段分组显示，避免信息重叠，移动端适配触摸操作
    - 国际化：支持中英文错误信息切换，根据用户浏览器语言自动选择
    - 可访问性：错误信息支持屏幕阅读器，提供aria-describedby关联到对应字段
更新方式: 无需进一步更新，已完成



模块关系图:
graph TD
    A[前端页面组件] -->|使用| B[AuthContext]
    B -->|访问方法| C[AuthProvider]
    C -->|调用方法| D[useAuth]
    D -->|认证方法| E[登录/注册表单]
    E -->|用户凭证| F[API客户端]
    F -->|HTTP请求| G[后端认证API]
    G -->|认证结果| H[认证服务]

文档与测试 🟡

 更新项目 README
状态: 未开始
描述: 完善项目介绍和设置指南
实现逻辑: 编写项目概述 -> 提供安装步骤 -> 添加使用说明
相关文件: README.md
验收标准:
- 时间限制：从未接触过项目的新开发者在30分钟内完成完整开发环境搭建
    - 步骤清晰：README包含分步指南，每步都有验证命令和预期输出示例
    - 一键脚本：提供npm run setup命令自动安装依赖、配置环境、初始化数据库
    - 环境检测：自动检测Node.js、pnpm、Docker等前置条件，提供安装指引
    - 故障排除：常见问题FAQ，包含10个最常见错误及解决方案
    - 验证机制：提供npm run verify命令验证环境配置正确性，输出绿色成功信息
    - 示例数据：自动创建示例用户(dev@example.com / dev123)和测试数据，立即可用
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 编写认证服务单元测试
状态: 未开始
描述: 为认证服务编写单元测试
实现逻辑: 测试登录、注册、密码重置功能
相关文件: apps/backend/src/auth/*.spec.ts
验收标准:
- 覆盖率指标：单元测试代码覆盖率≥80%，包含语句、分支、函数、行四种维度
    - 关键路径：认证、设备管理、告警处理、数据查询等核心业务逻辑100%覆盖
    - 测试类型：包含单元测试、集成测试、端到端测试三层测试金字塔
    - 持续集成：GitHub Actions自动运行测试，PR合并前必须通过全部测试
    - 测试报告：生成HTML格式的覆盖率报告，包含未覆盖代码的详细分析
    - 性能测试：关键接口性能测试，响应时间 < 200ms，并发支持100用户
    - 测试数据：使用factory模式生成测试数据，支持重复测试和边界值测试
依赖: 后端认证任务完成
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录




阶段二：核心监控功能 [70% 完成]
仪表盘 🟡

 创建仪表盘布局组件
状态: 已完成
描述: 提供应用主界面框架
实现逻辑: 创建导航栏、侧边栏、页面标题和内容区域
相关文件: apps/frontend/src/app/dashboard
验收标准:
- 布局响应：桌面端12列网格布局，平板端8列，移动端单列，断点768px和1024px
    - 导航功能：主导航包含5个入口(仪表板、设备、告警、设置、个人中心)，支持键盘快捷键
    - 加载性能：首屏加载时间 < 2秒，支持渐进式加载，骨架屏占位符
    - 数据展示：卡片式布局展示设备状态，支持拖拽调整顺序，记忆用户偏好
    - 搜索功能：全局搜索框支持设备名称模糊搜索，实时显示结果，响应时间 < 300ms
    - 主题切换：支持浅色/深色主题切换，记忆用户选择，切换无闪烁
    - 可访问性：支持键盘导航，所有交互元素有焦点指示，屏幕阅读器友好
更新方式: 无需进一步更新，已完成


 实现状态概览卡片
状态: 未开始
描述: 显示设备状态关键指标
实现逻辑: 从后端获取数据 -> 展示卡片 -> 定期更新
相关文件: apps/frontend/src/app/dashboard, apps/backend/src/dashboard
验收标准:
- 状态显示：在线设备显示绿色圆点，离线显示红色圆点，未知状态显示灰色圆点
    - 实时更新：每5秒自动刷新设备状态，支持手动刷新按钮，WebSocket连接优先
    - 视觉反馈：状态变化时有淡入淡出动画，离线设备卡片变暗，添加警告图标
    - 数据展示：卡片显示设备名称、最后在线时间、IP地址、设备类型、告警数量
    - 交互功能：点击卡片进入设备详情页，悬停显示快速操作菜单(查看、编辑、删除)
    - 性能优化：虚拟滚动支持1000+设备，仅渲染可视区域，内存使用 < 50MB
    - 离线处理：网络断开时显示离线提示，缓存最后状态，恢复后自动同步
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 添加实时数据图表
状态: 未开始
描述: 可视化设备指标数据
实现逻辑: 选择图表库 -> 渲染图表 -> 实现定时刷新
相关文件: apps/frontend/src/app/dashboard
子任务:
 选择图表库（候选：Chart.js、Recharts）
 实现 WebSocket 数据流
 提供轮询 fallback


验收标准:
- 实时更新：图表数据每5秒自动刷新，支持暂停/恢复更新，WebSocket优先推送
    - 时间范围：支持7种预设范围(15分钟、1小时、6小时、1天、7天、30天、90天)
    - 图表类型：支持折线图、面积图、柱状图三种可视化，自适应数据密度
    - 交互功能：鼠标悬停显示详细数据，支持缩放、平移、重置视图
    - 性能优化：1000个数据点渲染时间 < 500ms，支持数据抽样和虚拟滚动
    - 响应适配：移动端手势支持，双指缩放，横屏模式优化显示
    - 数据导出：支持CSV、PNG格式导出，导出时间 < 2秒，包含完整元数据
更新方式: 完成子任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 创建最近告警面板
状态: 未开始
描述: 显示最新告警信息
实现逻辑: 获取告警列表 -> 显示状态 -> 提供详情查看
相关文件: apps/frontend/src/app/dashboard, apps/backend/src/dashboard
验收标准:
- 告警展示：显示最新10条告警，包含告警级别、设备名称、告警内容、触发时间
    - 实时更新：新告警到达时顶部插入，支持声音提醒，可配置提醒频率
    - 详情查看：点击告警行展开详细信息，包含完整错误堆栈、建议解决方案
    - 过滤功能：按级别(严重/警告/信息)、设备、时间范围过滤，实时生效
    - 批量操作：支持批量确认、批量解决、批量删除，提供撤销操作
    - 视觉区分：不同级别使用颜色编码(红色/橙色/蓝色)，支持色盲友好模式
    - 性能优化：1000条告警列表滚动流畅，虚拟滚动仅渲染可视区域
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 实现数据刷新机制
状态: 未开始
描述: 优化数据刷新性能
实现逻辑: 设置定时器 -> 提供手动刷新 -> 优化请求频率
相关文件: apps/frontend/src/app/dashboard
验收标准:
- 自动刷新：所有仪表板数据每5秒自动更新，支持自定义刷新间隔(5s-60s)
    - 手动刷新：提供刷新按钮，点击立即获取最新数据，显示刷新动画
    - 智能刷新：页面不可见时暂停刷新，返回可见时立即刷新一次
    - 冲突处理：刷新过程中用户操作不中断，新数据无缝替换旧数据
    - 错误恢复：网络断开自动重试连接，恢复后自动同步所有数据
    - 性能控制：并发请求数限制在5个以内，避免服务器压力过大
    - 用户控制：提供全局暂停/恢复刷新开关，状态持久化存储
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录



模块关系图:
graph TD
    A[仪表盘页面] -->|请求数据| B[仪表盘控制器]
    B -->|获取数据| C[服务层]
    C -->|查询数据库| D[PrismaService]
    D -->|设备/指标/告警| E[数据库表]
    A -->|展示数据| F[状态概览卡片]
    A -->|展示数据| G[实时数据图表]
    A -->|展示数据| H[最近告警面板]

设备管理 🔴

 完善设备列表页面
状态: 已完成
描述: 显示设备信息并支持分页
实现逻辑: 获取设备列表 -> 展示信息 -> 支持分页和状态显示
相关文件: apps/frontend/src/app/devices, apps/backend/src/devices
验收标准:
- 列表展示：每页显示20个设备，支持10/20/50/100条分页选择，状态包含在线/离线/未知
    - 分页功能：数字页码+上一页/下一页，支持跳转到指定页，总页数实时显示
    - 状态过滤：支持按在线状态、设备类型、告警级别组合过滤，过滤条件URL同步
    - 排序功能：可按设备名称、最后在线时间、告警数量升序/降序排序
    - 搜索优化：实时搜索设备名称，支持模糊匹配，搜索响应时间 < 300ms
    - 批量操作：支持全选/反选，批量删除、批量导出，操作确认对话框
    - 性能保证：1000个设备列表滚动流畅，虚拟滚动仅渲染可视区域，内存优化
更新方式: 无需进一步更新，已完成


 创建设备详情页面
状态: 已完成
描述: 显示设备详细信息和告警历史
实现逻辑: 根据 ID 获取信息 -> 显示指标和告警
相关文件: apps/frontend/src/app/devices
验收标准: 显示设备详情、指标和告警历史
更新方式: 无需进一步更新，已完成


 实现设备添加表单
状态: 已完成
描述: 创建新设备
实现逻辑: 用户填写信息 -> 前端验证 -> 调用创建接口
相关文件: apps/frontend/src/app/devices
验收标准: 成功添加设备，列表自动更新
更新方式: 无需进一步更新，已完成


 添加设备编辑功能
状态: 已完成
描述: 编辑设备信息
实现逻辑: 显示当前信息 -> 用户修改 -> 调用更新接口
相关文件: apps/frontend/src/app/devices
验收标准: 成功编辑设备，显示更新结果
更新方式: 无需进一步更新，已完成


 实现设备删除操作
状态: 已完成
描述: 删除设备并更新列表
实现逻辑: 显示确认对话框 -> 调用删除接口 -> 更新列表
相关文件: apps/frontend/src/app/devices
验收标准: 设备删除后列表更新，显示成功提示
更新方式: 无需进一步更新，已完成


 添加设备搜索过滤
状态: 进行中
描述: 支持设备搜索和过滤
实现逻辑: 提供搜索输入 -> 发送搜索请求 -> 显示结果
相关文件: apps/frontend/src/app/devices
验收标准: 搜索返回匹配设备，性能良好
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录



模块关系图:
graph TD
    A[前端设备管理页面] -->|HTTP请求| B[DevicesController]
    B -->|API调用| C[DevicesService]
    C -->|使用| D[PrismaService]
    D -->|数据库操作| E[Device表]
    A -->|获取/更新状态| F[useDevices Hook]
    F -->|数据传输| G[设备数据模型]
    G -->|操作| H[Device DTO]


阶段三：数据展示与处理 [30% 完成]
指标处理 🟡

 实现指标数据收集服务
状态: 已完成
描述: 收集和存储设备指标数据
实现逻辑: 接收设备数据 -> 验证格式 -> 存储数据库
相关文件: apps/backend/src/devices, packages/types/src/metric.types.ts
验收标准: 指标数据正确存储，查询接口可用
更新方式: 无需进一步更新，已完成


 创建指标查询接口
状态: 未开始
描述: 提供指标数据查询 API
实现逻辑: 接收查询参数 -> 获取数据 -> 支持分页和排序
相关文件: apps/backend/src/devices
验收标准: 返回分页和排序后的指标数据
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 添加历史数据存储
状态: 未开始
描述: 存储和归档历史指标数据
实现逻辑: 设计历史数据表 -> 存储数据 -> 提供查询接口
相关文件: apps/backend/src/devices, schema.prisma
验收标准: 历史数据可查询，归档策略生效
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 实现数据聚合功能
状态: 未开始
描述: 支持指标数据聚合计算
实现逻辑: 获取数据 -> 按时间窗口分组 -> 计算聚合值
相关文件: apps/backend/src/devices
验收标准: 返回正确聚合结果（如平均值、最大值）
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 添加数据清理策略
状态: 未开始
描述: 自动清理过期数据
实现逻辑: 定义过期规则 -> 定期清理 -> 提供配置选项
相关文件: apps/backend/src/devices
验收标准: 过期数据自动清理，存储空间优化
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录



模块关系图:
graph TD
    A[设备端] -->|数据发送| B[指标收集服务接口]
    B -->|存储指标数据| C[指标数据表]
    C -->|查询/聚合| D[指标查询接口]
    C -->|查询/聚合| E[数据聚合服务]
    C -->|查询/聚合| F[告警创建逻辑]
    D -->|展示数据| G[前端图表展示]
    F -->|触发告警| H[告警记录表]
    H -->|通知| I[告警通知服务]

告警系统 🟡

 完善告警创建逻辑
状态: 已完成
描述: 根据指标触发告警
实现逻辑: 接收指标 -> 判断规则 -> 创建并存储告警
相关文件: apps/backend/src/devices, packages/types/src/alert.types.ts
验收标准: 告警正确触发并存储
更新方式: 无需进一步更新，已完成


 实现告警查询接口
状态: 未开始
描述: 提供告警数据查询 API
实现逻辑: 接收查询参数 -> 获取告警数据 -> 支持过滤和排序
相关文件: apps/backend/src/devices
验收标准: 返回过滤和排序后的告警数据
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 添加告警确认功能
状态: 未开始
描述: 支持用户确认告警
实现逻辑: 接收确认请求 -> 更新状态 -> 记录确认人
相关文件: apps/backend/src/devices
验收标准: 告警状态更新，记录确认信息
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 创建告警解决流程
状态: 未开始
描述: 支持告警解决和关闭
实现逻辑: 接收解决请求 -> 更新状态 -> 关闭通知
相关文件: apps/backend/src/devices
验收标准: 告警状态更新为已解决，通知关闭
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 实现告警通知机制
状态: 未开始
描述: 支持多种通知方式
实现逻辑: 告警触发时发送邮件、短信或 Webhook
相关文件: apps/backend/src/devices
验收标准: 通知按配置发送，多种方式支持
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录



模块关系图:
graph TD
    A[指标数据] -->|触发| B[告警规则引擎]
    B -->|评估| C[告警条件]
    C -->|生成告警| D[告警创建逻辑]
    D -->|存储| E[告警记录表]
    E -->|通知| F[告警通知服务]
    E -->|查询/更新| G[告警查询API]
    G -->|展示| H[前端告警页面]
    F -->|发送通知| I[用户接收通知]


阶段四：用户体验优化 [40% 完成]
UI 组件库 🟡

 创建基础 UI 组件
状态: 已完成
描述: 实现 Button、Card、Input 等组件
实现逻辑: 基于 shadcn/ui 和 tailwindcss 实现可复用组件
相关文件: apps/frontend/src/components/ui, packages/ui
验收标准: 组件可复用，样式一致
更新方式: 无需进一步更新，已完成


 实现数据表格组件
状态: 未开始
描述: 支持排序和分页的表格组件
实现逻辑: 接收数据 -> 渲染表格 -> 支持排序和分页
相关文件: apps/frontend/src/components/ui
验收标准: 表格支持排序、分页和行选择
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 添加图表组件集成
状态: 未开始
描述: 集成第三方图表库
实现逻辑: 封装通用图表组件 -> 支持多种图表类型
相关文件: apps/frontend/src/components/ui
验收标准: 图表正确渲染，支持配置选项
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 创建模态框组件
状态: 未开始
描述: 实现通用模态框
实现逻辑: 提供显示/隐藏功能 -> 支持自定义内容
相关文件: apps/frontend/src/components/ui
验收标准: 模态框支持确认/取消，关闭逻辑正常
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 实现通知 Toast 组件
状态: 未开始
描述: 实现通知系统
实现逻辑: 支持成功、错误等通知 -> 自动/手动关闭
相关文件: apps/frontend/src/components/ui
验收标准: 通知正确显示，支持队列管理
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录



模块关系图:
graph TD
    A[前端页面组件] -->|使用| B[UI组件库]
    B -->|基于| C[shadcn/ui组件]
    C -->|样式支持| D[tailwindcss]

响应式设计 🟡

 优化移动端布局
状态: 未开始
描述: 适配小屏幕设备
实现逻辑: 检测屏幕尺寸 -> 应用移动端样式 -> 优化交互
相关文件: apps/frontend/src/app/**/*.tsx
验收标准: 移动端布局正常，触摸交互流畅
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 添加页面加载状态
状态: 已完成
描述: 显示页面加载指示器
实现逻辑: 数据加载时显示指示器 -> 加载完成隐藏
相关文件: apps/frontend/src/app/**/*.tsx
验收标准: 加载状态正确显示和隐藏
更新方式: 无需进一步更新，已完成


 实现错误边界处理
状态: 未开始
描述: 捕获和显示渲染错误
实现逻辑: 创建错误边界组件 -> 显示错误页面 -> 提供恢复
相关文件: apps/frontend/src/app
验收标准: 错误被捕获，显示友好提示
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 优化导航用户体验
状态: 未开始
描述: 改进导航栏和面包屑
实现逻辑: 设计导航结构 -> 同步状态 -> 优化交互
相关文件: apps/frontend/src/app
验收标准: 导航清晰，状态同步
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 添加页面过渡动画
状态: 未开始
描述: 实现页面切换动画
实现逻辑: 集成动画库 -> 添加切换和交互动画
相关文件: apps/frontend/src/app
验收标准: 动画流畅，性能优化
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录



模块关系图:
graph TD
    A[浏览器/设备] -->|屏幕尺寸| B[响应式设计系统]
    B -->|应用| C[前端组件]
    C -->|响应式类| D[tailwindcss]


阶段五：API 与数据流 [60% 完成]
API 客户端 🟡

 完善 API 请求封装
状态: 已完成
描述: 封装 HTTP 请求方法
实现逻辑: 统一请求头 -> 提供拦截和响应处理
相关文件: apps/frontend/src/lib/api.ts
验收标准: API 调用简洁，请求头一致
更新方式: 无需进一步更新，已完成


 添加请求重试机制
状态: 未开始
描述: 自动重试失败请求
实现逻辑: 使用指数退避算法 -> 限制重试次数
相关文件: apps/frontend/src/lib/api.ts
验收标准: 失败请求自动重试，错误处理正确
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 实现错误统一处理
状态: 已完成
描述: 统一处理 API 错误
实现逻辑: 捕获错误 -> 格式化信息 -> 记录日志
相关文件: apps/frontend/src/lib/api.ts
验收标准: 错误信息统一，日志记录完整
更新方式: 无需进一步更新，已完成


 添加请求取消功能
状态: 进行中
描述: 支持取消正在进行的请求
实现逻辑: 提供取消令牌 -> 处理资源清理
相关文件: apps/frontend/src/lib/api.ts
验收标准: 请求可取消，无内存泄漏
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 优化 TypeScript 类型
状态: 已完成
描述: 为 API 定义类型
实现逻辑: 定义请求和响应类型 -> 减少运行时错误
相关文件: apps/frontend/src/lib/api.ts
验收标准: 类型安全，编译无错误
更新方式: 无需进一步更新，已完成



模块关系图:
graph TD
    A[前端页面组件] -->|调用| B[自定义Hooks]
    B -->|使用| C[API客户端]
    C -->|HTTP请求| D[后端API服务]
    D -->|处理业务逻辑| E[PrismaService]
    C -->|封装HTTP操作| F[TypeScript类型]

状态管理 🟡

 完善 useAuth hook
状态: 已完成
描述: 管理用户认证状态
实现逻辑: 提供登录/登出 -> 处理令牌存储和刷新
相关文件: apps/frontend/src/hooks
验收标准: 认证状态正确管理，方法正常
更新方式: 无需进一步更新，已完成


 实现 useDevices hook
状态: 已完成
描述: 管理设备数据状态
实现逻辑: 提供数据获取和操作方法
相关文件: apps/frontend/src/hooks
验收标准: 设备数据正确更新，操作正常
更新方式: 无需进一步更新，已完成


 创建 useAlerts hook
状态: 进行中
描述: 管理告警数据状态
实现逻辑: 提供告警数据获取和操作方法
相关文件: apps/frontend/src/hooks
验收标准: 告警数据正确管理，操作正常
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 添加 useMetrics hook
状态: 未开始
描述: 管理指标数据状态
实现逻辑: 提供数据获取和订阅方法 -> 优化缓存
相关文件: apps/frontend/src/hooks
验收标准: 指标数据实时更新，缓存优化
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 实现数据缓存策略
状态: 未开始
描述: 优化数据获取性能
实现逻辑: 设计缓存机制 -> 处理更新和失效
相关文件: apps/frontend/src/hooks
验收标准: 数据缓存有效，性能提升
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录



模块关系图:
graph TD
    A[前端组件] -->|使用| B[自定义Hooks]
    B -->|管理状态| C[React状态管理]
    C -->|状态更新| D[API客户端]
    D -->|数据获取| E[后端服务]


阶段六：后端服务完善 [50% 完成]
数据库服务 🟡

 优化 Prisma 服务配置
状态: 已完成
描述: 配置 Prisma 客户端
实现逻辑: 优化数据库连接 -> 提供服务接口
相关文件: apps/backend/src/prisma
验收标准: 数据库连接稳定，性能优化
更新方式: 无需进一步更新，已完成


 添加数据库事务处理
状态: 进行中
描述: 支持数据库事务
实现逻辑: 实现事务管理器 -> 支持回滚 -> 优化性能
相关文件: apps/backend/src/prisma
验收标准: 事务执行正确，数据一致
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 实现数据验证中间件
状态: 已完成
描述: 验证请求数据
实现逻辑: 检查数据格式 -> 防止无效数据
相关文件: apps/backend/src/prisma
验收标准: 无效数据被拦截，错误信息清晰
更新方式: 无需进一步更新，已完成


 创建数据种子脚本
状态: 未开始
描述: 初始化数据库数据
实现逻辑: 定义种子数据 -> 支持环境区分
相关文件: apps/backend/src/prisma
验收标准: 开发环境快速初始化
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 添加数据库迁移脚本
状态: 未开始
描述: 管理数据库模式变更
实现逻辑: 使用 Prisma Migrate -> 支持回滚
相关文件: apps/backend/src/prisma
验收标准: 迁移无错误，回滚正常
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录



模块关系图:
graph TD
    A[后端服务层] -->|调用| B[PrismaService]
    B -->|操作| C[数据验证中间件]
    C -->|保证数据| D[数据库]
    D -->|Prisma ORM| E[schema.prisma]
    E -->|操作| F[数据种子/迁移脚本]


阶段七：安全增强 [70% 完成]

 完善安全中间件
状态: 已完成
描述: 添加安全头和过滤机制
实现逻辑: 添加安全头 -> 防止 Web 攻击 -> 记录日志
相关文件: apps/backend/src/security
验收标准: 安全头生效，恶意请求被拦截
更新方式: 无需进一步更新，已完成


 添加速率限制
状态: 进行中
描述: 控制请求频率
实现逻辑: 使用 express-rate-limit -> 限制 IP 请求
相关文件: apps/backend/src/security
验收标准: 请求频率受限，配置灵活
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 实现输入验证
状态: 已完成
描述: 验证请求参数
实现逻辑: 检查数据类型和格式 -> 防止恶意输入
相关文件: apps/backend/src/security
验收标准: 无效输入被拦截，错误信息清晰
更新方式: 无需进一步更新，已完成


 添加 CORS 配置
状态: 已完成
描述: 配置跨域资源共享
实现逻辑: 限制来源和方法 -> 确保安全
相关文件: apps/backend/src/security
验收标准: 跨域请求按配置处理
更新方式: 无需进一步更新，已完成


 创建请求日志
状态: 进行中
描述: 记录请求和响应信息
实现逻辑: 设计日志格式 -> 支持分析 -> 便于审计
相关文件: apps/backend/src/security
验收标准: 日志完整，分析工具可用
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录



模块关系图:
graph TD
    A[客户端请求] -->|请求| B[安全中间件层]
    B -->|验证/过滤| C[CORS配置]
    C -->|控制跨域| D[输入验证]
    D -->|保护| E[速率限制模块]
    E -->|限制请求频率| F[日志系统]
    F -->|安全审计| G[应用程序]


阶段八：测试与质量 [40% 完成]
单元测试 🟡

 编写认证服务测试
状态: 进行中
描述: 测试认证服务功能
实现逻辑: 测试登录、注册、密码重置
相关文件: apps/backend/src/**/*.spec.ts
验收标准: 测试覆盖率达 80%
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 添加设备服务测试
状态: 进行中
描述: 测试设备管理功能
实现逻辑: 测试 CRUD 和状态管理
相关文件: apps/backend/src/**/*.spec.ts
验收标准: 测试覆盖率达 80%
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 实现工具函数测试
状态: 进行中
描述: 测试工具函数
实现逻辑: 测试边界条件和异常情况
相关文件: apps/backend/src/**/*.spec.ts
验收标准: 工具函数测试通过
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 创建 API 端点测试
状态: 进行中
描述: 测试 API 端点
实现逻辑: 测试认证和数据验证
相关文件: apps/backend/src/**/*.spec.ts
验收标准: API 功能正确
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录



E2E 测试 🟡

 编写登录流程测试
状态: 进行中
描述: 测试完整登录流程
实现逻辑: 测试正常登录、错误处理和登出
相关文件: apps/backend/src/**/*.e2e-spec.ts
验收标准: 登录流程无错误
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 添加设备管理测试
状态: 进行中
描述: 测试设备管理流程
实现逻辑: 测试 CRUD 和批量操作
相关文件: apps/backend/src/**/*.e2e-spec.ts
验收标准: 设备管理功能完整
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 实现监控功能测试
状态: 进行中
描述: 测试数据收集和告警
实现逻辑: 测试数据收集、告警触发和通知
相关文件: apps/backend/src/**/*.e2e-spec.ts
验收标准: 监控系统正常工作
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 创建性能测试套件
状态: 进行中
描述: 测试系统性能
实现逻辑: 测试并发请求和响应时间
相关文件: apps/backend/src/**/*.e2e-spec.ts
验收标准: 系统支持 1000 并发，响应时间 < 200ms
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录



模块关系图:
graph TD
    A[测试框架] -->|执行| B[单元测试]
    B -->|验证| C[E2E测试]
    C -->|端到端测试| D[被测系统]
    D -->|性能评估| E[性能测试工具]
    E -->|生成| F[测试报告]


阶段九：部署与运维 [30% 完成]
容器化 🟡

 [~] 优化 Docker 配置文件
状态: 进行中
描述: 优化 Docker 构建
实现逻辑: 减少镜像体积 -> 使用多阶段构建
相关文件: docker/, docker-compose.yml
验收标准: 镜像体积减少 30%
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 [~] 添加多阶段构建
状态: 进行中
描述: 分离开发和生产依赖
实现逻辑: 划分构建阶段 -> 优化生产镜像
相关文件: docker/
验收标准: 生产镜像体积优化
更新方式: 完成任务后，编辑 TODO.md 将 [~] 改为 [x]，并在变更日志中记录


 [~] 创建开发环境配置
状态: 进行中
描述: 配置开发环境
实现逻辑: 配置环境变量 -> 集成开发工具
相关文件: docker-compose.yml
验收标准: 开发环境支持热重载
更新方式: 完成任务后，编辑 TODO.md 将 [~] 改为 [x]，并在变更日志中记录


 [~] 完善生产环境配置
状态: 进行中
描述: 优化生产环境
实现逻辑: 配置变量 -> 添加安全设置 -> 优化性能
相关文件: docker-compose.yml
验收标准: 生产环境稳定运行
更新方式: 完成任务后，编辑 TODO.md 将 [~] 改为 [x]，并在变更日志中记录



部署配置 🟢

 优化 Railway 部署配置
状态: 未开始
描述: 优化后端部署
实现逻辑: 配置环境变量 -> 优化构建 -> 添加健康检查
相关文件: railway.json
验收标准: 部署稳定，健康检查通过
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 完善 Vercel 部署设置
状态: 未开始
描述: 优化前端部署
实现逻辑: 优化构建 -> 添加缓存 -> 实现预渲染
相关文件: vercel.json
验收标准: 页面加载时间 < 2s
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 添加环境变量管理
状态: 未开始
描述: 管理环境变量
实现逻辑: 设计变量结构 -> 保护敏感信息
相关文件: railway.json, vercel.json
验收标准: 环境变量安全配置
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 创建部署脚本
状态: 未开始
描述: 自动化部署流程
实现逻辑: 编写脚本 -> 添加验证和回滚
相关文件: scripts/
验收标准: 部署自动化，验证通过
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录



项目文档 🟢

 完善 API 文档
状态: 未开始
描述: 文档化 API 接口
实现逻辑: 使用 OpenAPI 3.0 -> 提供在线文档和示例
相关文件: docs/
验收标准: API 文档完整，示例可运行
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 创建部署指南
状态: 未开始
描述: 编写部署步骤
实现逻辑: 说明环境配置 -> 提供故障排除
相关文件: docs/
验收标准: 新人可按指南部署
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 编写开发文档
状态: 未开始
描述: 提供架构和贡献指南
实现逻辑: 编写架构文档 -> 说明规范 -> 创建贡献指南
相关文件: docs/
验收标准: 文档支持团队协作
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录



维护脚本 🟢

 添加数据库备份脚本
状态: 未开始
描述: 实现数据库备份
实现逻辑: 备份数据 -> 提供恢复 -> 优化存储
相关文件: scripts/
验收标准: 备份和恢复正常
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 创建数据迁移工具
状态: 未开始
描述: 支持数据迁移
实现逻辑: 设计迁移工具 -> 实现转换和验证
相关文件: scripts/
验收标准: 数据迁移无错误
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 实现日志分析脚本
状态: 未开始
描述: 分析系统日志
实现逻辑: 解析日志 -> 统计分析 -> 检测异常
相关文件: scripts/
验收标准: 提供准确分析报告
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录


 添加监控检查脚本
状态: 未开始
描述: 检查服务健康
实现逻辑: 检查健康状态 -> 监控性能 -> 发送通知
相关文件: scripts/
验收标准: 监控正常，通知准确
更新方式: 完成任务后，编辑 TODO.md 将 [ ] 改为 [x]，并在变更日志中记录



模块关系图:
graph TD
    A[系统定时任务] -->|执行| B[维护脚本]
    B -->|操作系统资源| C[数据库系统]
    C -->|读写数据| D[文件系统]
    D -->|记录| E[日志系统]
    E -->|监控系统| F[监控系统]


数据库模式关系图
erDiagram
    User ||--o{ Device : owns
    Device ||--o{ Metric : generates
    Device ||--o{ Alert : triggers
    DeviceGroup ||--o{ Device : contains
    User {
        int id PK
        string email
        string password
        string name
        string role
        boolean isActive
        datetime deletedAt
        datetime lastLoginAt
        int failedLoginAttempts
        datetime lockedUntil
        boolean mfaEnabled
        string mfaSecret
        datetime createdAt
        datetime updatedAt
        string passwordResetToken
        datetime passwordResetExpires
    }
    DeviceGroup {
        int id PK
        string name
        string description
        boolean isActive
        datetime createdAt
        datetime updatedAt
    }
    Device {
        int id PK
        string name
        string hostname
        string ipAddress
        string description
        string status
        string type
        string location
        string tags
        boolean isActive
        datetime createdAt
        datetime updatedAt
        datetime lastSeen
        int userId FK
        int deviceGroupId FK
    }
    Metric {
        int id PK
        int deviceId FK
        float cpu
        float memory
        float disk
        float networkIn
        float networkOut
        float uptime
        float temperature
        json custom
        datetime timestamp
    }
    Alert {
        int id PK
        int deviceId FK
        string type
        string message
        string severity
        boolean isResolved
        datetime resolvedAt
        datetime acknowledgedAt
        json metadata
        datetime createdAt
        datetime updatedAt
        int userId FK
    }

数据库模式说明:

Metric 表: 为 deviceId 和 timestamp 添加索引，支持高效时间序列查询
Alert 表: 为 createdAt 添加索引，优化最新告警排序


推荐开发顺序
第一周：认证基础

修复后端认证守卫
完善前端登录功能
实现令牌管理
添加路由保护
编写认证服务单元测试
更新项目 README

第二周：核心功能

创建仪表盘页面
实现设备列表
添加设备操作
完善数据展示
编写设备服务单元测试

第三周：用户体验与测试

优化 UI 组件
添加响应式设计
实现加载状态和错误处理
编写前端组件单元测试

第四周：高级功能

实现实时数据推送
完善告警通知系统
集成数据图表
优化性能


优先级标记

🔴 高优先级: 认证、核心功能
🟡 中优先级: 用户体验、测试
🟢 低优先级: 高级功能、文档、部署


变更日志

2025-09-14: 重构 TODO.md，添加任务状态更新指南，明确状态标记和更新方式
2025-09-14: 增加权限装饰器任务，拆分复杂任务
2025-09-10: 标记邮件发送框架为已完成
2025-09-14: 更新任务进度状态，同步最新开发进展


术语表

AuthContext: 用于管理用户认证状态的 React 上下文
PrismaService: 使用 Prisma ORM 的后端数据库操作服务
useAuth: 提供认证相关方法的自定义 React Hook
JwtStrategy: 处理 JWT 验证的 NestJS 策略类
